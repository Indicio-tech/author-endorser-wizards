FROM python:3.8.11

USER root
RUN apt-get update
RUN apt-get install -y wget gcc openssl pkg-config libssl-dev


ENV LIBINDY_DIR=/home/indy/.local/lib
ENV LD_LIBRARY_PATH=/home/indy/.local/lib

ADD . .

ADD https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 ./jq
RUN chmod +x ./jq
COPY EndorserWizard.py EndorserWizard.py
RUN chmod +x ./AuthorWizard.py

# python configurations added by Gavin Bendixsen

RUN apt-get install -y software-properties-common
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys CE7709D068DB5E88
RUN add-apt-repository "deb https://repo.sovrin.org/sdk/deb bionic master"
RUN apt clean
RUN apt-get update --allow-insecure-repositories # Remove allow plugin when keys are online
RUN apt-get -y upgrade
RUN apt-get install -y --allow-unauthenticated libindy # Remove allow plugin when keys are onlnine
RUN python3 -m pip install --upgrade pip
RUN python3 -m pip install aiohttp base58 indy Python3-indy asyncio

USER $user

CMD python3 ./EndorserWizard.py